# Network - TCP_IP_1

## 설명

### IP (인터넷 프로토콜)

IP라는 것은 인터넷 프로토콜의 준말로서 인터넷에서 통신되는 규약을 말합니다.
이러한 IP의 역할은 아래와 같습니다.

- 지정한 IP 주소에 데이터 전달
- 패킷이라는 데이터 통신단위로 전달

데이터는 `패킷` 이라는 통신단위로 데이터를 전달합니다.

IP 패킷 정보는 다음과 같습니다.
![](https://images.velog.io/images/doodream/post/703bc656-dfa3-44e1-bc50-826f905573b5/image.png)

IP 패킷이라는 단위에는 출발지에 대한 IP주소, 목적지에 대한 정보등이 들어있는 데이터들이 전송데이터를 감싸고 있습니다.

> 실제 인터넷 환경을 요약하면 이러한 IP 패킷을 클라이언트에서 데이터를 전송하게 되면 목적지의 도메인 주소와 IP 주소를 매칭하기 위해 그러한 정보를 담고 있는 DNS 서버에 쿼리를 날리며 DNS 정보가 담겨있는 서버를 찾습니다. 해당 서버를 찾으면 3-way handshake로 데이터 연결을 위한 TCP 연결을 하게 됩니다. 이후 IP 주소로 HTTP 요청을 보내게 됩니다.
> ![](https://images.velog.io/images/doodream/post/0c3cb5f0-7ee4-4ebe-a191-e677bab1b516/image.png)
> 이렇게 연결된 상태에서 위와 같이 HTTP 프로토콜에 따라 IP 패킷 데이터가 오고 가게 됩니다. 이는 데이터의 요청과 응답모두 같은 과정을 겪게 됩니다. 도착한 데이터들은 OSI 7계층에 따라 디캡슐화 되며 안전하게 데이터를 어플리케이션에 전달합니다.

### IP 프로토콜의 한계

IP 프로토콜은 IP 주소정보를 갖고 IP 패킷에 따라 전송하는 것을 말합니다. 이로선 한계가 있습니다.

**비연결성**

- 예를 들면 상대방의 컴퓨터가 꺼져있는데 그냥 데이터를 보낼수도 있습니다.

**비신뢰성**

- 데이터 패킷이 중간에 사라지거나 패킷이 순서대로 오지 않을수도 있습니다.

**프로그램 구분**

- 같은 IP를 사용하는 서버에서 통신하는 어플리케이션이 둘이상 일때 어떤 프로그램이 데이터를 받게 될지 구분할 수 없습니다.

등등.. 여러가지 한계가 존재합니다.

이러한 것들을 해결해주는 것이 TCP 라고 합니다.

### TCP

![](https://images.velog.io/images/doodream/post/088773e3-8009-4caf-b8de-f968513d2ede/image.png)

![](https://images.velog.io/images/doodream/post/b4e690a7-1522-4de6-9c69-9e935e88f60a/image.png)

> OSI 7계층을 인터넷 프로토콜기준으로 나누어 보자면 4개의 계층으로 분류 됩니다.
> ![](https://images.velog.io/images/doodream/post/13d124c6-7580-4c40-88fe-f626343ab9a5/image.png)

각각 보기 쉽게 정리하자면 네트워크계층은 물리계층과 데이터계층으로서 컴퓨터의 랜카드에서 부터 다시 컴퓨터의 랜카드 로 연결될 때까지의 계층을 의미 합니다.
OS 계층은 이렇게 받은 데이터들을 가공해서 연결하는 부분입니다.

TCP는 다음과 같은 내용을 제공합니다.

- 오류없는 데이터 전송
- 순서에 맞는 전달
- 조각나지 않는 데이터 스트림

인터넷 자체가 TCP/IP 프로토콜이 대중화 되어 있습니다. TCP와 IPr가 층을 이루는 패킷 교환 네트워크 프로토콜의 집합입니다.

> HTTP - 애플리케이션 계층
> TCP - 전송계층
> IP - 네트워크 계층

### TCP 스트림은 세그먼트로 나뉘어 IP패킷을 통해 전송됩니다.

TCP는 세그먼트라는 단위로 데이터 스트림을 잘게 나누고 세그먼트를 IP 패킷에 담아 데이터를 전달합니다.

![](https://images.velog.io/images/doodream/post/4a458d4a-300e-4129-8e2b-6d3a84c084e8/image.png)
Data는 TCP 패킷 : 세그먼트 입니다.

![](https://images.velog.io/images/doodream/post/2e36402c-58fa-417a-9cb2-f8830e578c75/image.png)

위 두개를 합쳤을 때 IP 패킷이라고 부릅니다.

### TCP 소켓

소켓 API (운영체제가 제공하는)를 사용하면 TCP 종단 데이터 구조를 생성하고 원격 서버의 TCP 종단에 그 종단 데이터 구조를 연결하여 데이터 스트림을 읽고 쓸 수 있습니다. 이 연결은 기본적인 네트워크 프로토콜의 핸드셰이킹, 그리고 TCP 데이터 스트림, IP 패킷의 캡슐화 디캡슐화를 외부로 부터 숨깁니다.

![](https://images.velog.io/images/doodream/post/4298a291-40c5-48e2-8c6f-e76be058b959/image.png)

서버 : 새로운 소켓을 만듭니다.
서버 : 80 포트로 소켓을 묶습니다.
서버 : 소켓 커넥션을 허가 합니다.
서버 : 커넥션을 기다립니다. (accept)

클라 : IP 주소와 포트를 얻습니다.
클라 : 새로운 소켓을 생성합니다.
클라 : 서버의 IP포트로 연결합니다.

서버 : 애플리케이션 커넥션을 통지합니다.
서버 : 요청을 읽기 시작합니다.

클라 : 성공적으로 연결되었습ㄴ니다.
클라 : HTTP 요청을 보냅니다.
클라 : HTTP 요청을 기다립니다.

서버 : HTTP 요청을 처리합니다.
서버 : HTTP 응답을 보냅니다.

클라 : HTTP 응답을 처리합니다.
클라 : 커넥션을 닫습니다.

서버 : 커넥션을 닫습니다.

## 요약

- IP라는 것은 인터넷 프로토콜의 준말로서 인터넷에서 통신되는 규약을 말합니다.
- TCP는 IP를 보완해주는 상위의 프로토콜입니다. 오류없는 데이터 전송, 순서에 맞는 전달, 조각나지 않는 데이터 스트림

## 참고

- HTTP 완벽가이드
